import { strict as assert } from 'node:assert';
import { describe, it, after } from 'node:test';
import cl from '../index.js';


const constants: ReadonlyArray<keyof typeof cl> = [
	'size_CHAR', 'size_SHORT', 'size_INT', 'size_LONG', 'size_FLOAT', 'size_DOUBLE', 'size_HALF',
	'DEVICE_NOT_FOUND', 'DEVICE_NOT_AVAILABLE', 'COMPILER_NOT_AVAILABLE',
	'MEM_OBJECT_ALLOCATION_FAILURE', 'OUT_OF_RESOURCES', 'OUT_OF_HOST_MEMORY',
	'PROFILING_INFO_NOT_AVAILABLE', 'MEM_COPY_OVERLAP', 'IMAGE_FORMAT_MISMATCH',
	'IMAGE_FORMAT_NOT_SUPPORTED', 'BUILD_PROGRAM_FAILURE', 'MAP_FAILURE',
	'MISALIGNED_SUB_BUFFER_OFFSET', 'EXEC_STATUS_ERROR_FOR_EVENTS_IN_WAIT_LIST',
	'COMPILE_PROGRAM_FAILURE', 'LINKER_NOT_AVAILABLE', 'LINK_PROGRAM_FAILURE',
	'DEVICE_PARTITION_FAILED', 'KERNEL_ARG_INFO_NOT_AVAILABLE', 'INVALID_VALUE',
	'INVALID_DEVICE_TYPE', 'INVALID_PLATFORM', 'INVALID_DEVICE', 'INVALID_CONTEXT',
	'INVALID_QUEUE_PROPERTIES', 'INVALID_COMMAND_QUEUE', 'INVALID_HOST_PTR',
	'INVALID_MEM_OBJECT', 'INVALID_IMAGE_FORMAT_DESCRIPTOR', 'INVALID_IMAGE_SIZE',
	'INVALID_SAMPLER', 'INVALID_BINARY', 'INVALID_BUILD_OPTIONS', 'INVALID_PROGRAM',
	'INVALID_PROGRAM_EXECUTABLE', 'INVALID_KERNEL_NAME', 'INVALID_KERNEL_DEFINITION',
	'INVALID_KERNEL', 'INVALID_ARG_INDEX', 'INVALID_ARG_VALUE', 'INVALID_ARG_SIZE',
	'INVALID_KERNEL_ARGS', 'INVALID_WORK_DIMENSION', 'INVALID_WORK_GROUP_SIZE',
	'INVALID_WORK_ITEM_SIZE', 'INVALID_GLOBAL_OFFSET', 'INVALID_EVENT_WAIT_LIST',
	'INVALID_EVENT', 'INVALID_OPERATION', 'INVALID_GL_OBJECT', 'INVALID_BUFFER_SIZE',
	'INVALID_MIP_LEVEL', 'INVALID_GLOBAL_WORK_SIZE', 'INVALID_PROPERTY',
	'INVALID_IMAGE_DESCRIPTOR', 'INVALID_COMPILER_OPTIONS', 'INVALID_LINKER_OPTIONS',
	'INVALID_DEVICE_PARTITION_COUNT', 'PLATFORM_NOT_FOUND_KHR',
	'INVALID_GL_SHAREGROUP_REFERENCE_KHR',
	'SUCCESS', 'VERSION_1_0', 'VERSION_1_1', 'VERSION_1_2',
	'FALSE', 'TRUE', 'BLOCKING', 'NON_BLOCKING',
	'PLATFORM_PROFILE', 'PLATFORM_VERSION', 'PLATFORM_NAME', 'PLATFORM_VENDOR',
	'PLATFORM_EXTENSIONS', 'DEVICE_TYPE_DEFAULT', 'DEVICE_TYPE_CPU',
	'DEVICE_TYPE_GPU', 'DEVICE_TYPE_ACCELERATOR', 'DEVICE_TYPE_CUSTOM',
	'DEVICE_TYPE_ALL', 'DEVICE_TYPE', 'DEVICE_VENDOR_ID', 'DEVICE_MAX_COMPUTE_UNITS',
	'DEVICE_MAX_WORK_ITEM_DIMENSIONS', 'DEVICE_MAX_WORK_GROUP_SIZE',
	'DEVICE_MAX_WORK_ITEM_SIZES', 'DEVICE_PREFERRED_VECTOR_WIDTH_CHAR',
	'DEVICE_PREFERRED_VECTOR_WIDTH_SHORT', 'DEVICE_PREFERRED_VECTOR_WIDTH_INT',
	'DEVICE_PREFERRED_VECTOR_WIDTH_LONG', 'DEVICE_PREFERRED_VECTOR_WIDTH_FLOAT',
	'DEVICE_PREFERRED_VECTOR_WIDTH_DOUBLE', 'DEVICE_MAX_CLOCK_FREQUENCY',
	'DEVICE_ADDRESS_BITS', 'DEVICE_MAX_READ_IMAGE_ARGS', 'DEVICE_MAX_WRITE_IMAGE_ARGS',
	'DEVICE_MAX_MEM_ALLOC_SIZE', 'DEVICE_IMAGE2D_MAX_WIDTH', 'DEVICE_IMAGE2D_MAX_HEIGHT',
	'DEVICE_IMAGE3D_MAX_WIDTH', 'DEVICE_IMAGE3D_MAX_HEIGHT', 'DEVICE_IMAGE3D_MAX_DEPTH',
	'DEVICE_IMAGE_SUPPORT', 'DEVICE_MAX_PARAMETER_SIZE', 'DEVICE_MAX_SAMPLERS',
	'DEVICE_MEM_BASE_ADDR_ALIGN', 'DEVICE_MIN_DATA_TYPE_ALIGN_SIZE',
	'DEVICE_SINGLE_FP_CONFIG', 'DEVICE_GLOBAL_MEM_CACHE_TYPE',
	'DEVICE_GLOBAL_MEM_CACHELINE_SIZE', 'DEVICE_GLOBAL_MEM_CACHE_SIZE',
	'DEVICE_GLOBAL_MEM_SIZE', 'DEVICE_MAX_CONSTANT_BUFFER_SIZE',
	'DEVICE_MAX_CONSTANT_ARGS', 'DEVICE_LOCAL_MEM_TYPE', 'DEVICE_LOCAL_MEM_SIZE',
	'DEVICE_ERROR_CORRECTION_SUPPORT', 'DEVICE_PROFILING_TIMER_RESOLUTION',
	'DEVICE_ENDIAN_LITTLE', 'DEVICE_AVAILABLE', 'DEVICE_COMPILER_AVAILABLE',
	'DEVICE_EXECUTION_CAPABILITIES', 'DEVICE_QUEUE_PROPERTIES', 'DEVICE_NAME',
	'DEVICE_VENDOR', 'DRIVER_VERSION', 'DEVICE_PROFILE', 'DEVICE_VERSION',
	'DEVICE_EXTENSIONS', 'DEVICE_PLATFORM', 'DEVICE_DOUBLE_FP_CONFIG',
	'DEVICE_HALF_FP_CONFIG', 'DEVICE_PREFERRED_VECTOR_WIDTH_HALF',
	'DEVICE_HOST_UNIFIED_MEMORY', 'DEVICE_NATIVE_VECTOR_WIDTH_CHAR',
	'DEVICE_NATIVE_VECTOR_WIDTH_SHORT', 'DEVICE_NATIVE_VECTOR_WIDTH_INT',
	'DEVICE_NATIVE_VECTOR_WIDTH_LONG', 'DEVICE_NATIVE_VECTOR_WIDTH_FLOAT',
	'DEVICE_NATIVE_VECTOR_WIDTH_DOUBLE', 'DEVICE_NATIVE_VECTOR_WIDTH_HALF',
	'DEVICE_OPENCL_C_VERSION', 'DEVICE_LINKER_AVAILABLE', 'DEVICE_BUILT_IN_KERNELS',
	'DEVICE_IMAGE_MAX_BUFFER_SIZE', 'DEVICE_IMAGE_MAX_ARRAY_SIZE', 'DEVICE_PARENT_DEVICE',
	'DEVICE_PARTITION_MAX_SUB_DEVICES', 'DEVICE_PARTITION_PROPERTIES',
	'DEVICE_PARTITION_AFFINITY_DOMAIN', 'DEVICE_PARTITION_TYPE', 'DEVICE_REFERENCE_COUNT',
	'DEVICE_PREFERRED_INTEROP_USER_SYNC', 'DEVICE_PRINTF_BUFFER_SIZE',
	'FP_DENORM', 'FP_INF_NAN', 'FP_ROUND_TO_NEAREST', 'FP_ROUND_TO_ZERO',
	'FP_ROUND_TO_INF', 'FP_FMA', 'FP_SOFT_FLOAT', 'FP_CORRECTLY_ROUNDED_DIVIDE_SQRT',
	'NONE', 'READ_ONLY_CACHE', 'READ_WRITE_CACHE', 'LOCAL', 'GLOBAL',
	'EXEC_KERNEL', 'EXEC_NATIVE_KERNEL', 'QUEUE_OUT_OF_ORDER_EXEC_MODE_ENABLE',
	'QUEUE_PROFILING_ENABLE', 'CONTEXT_REFERENCE_COUNT', 'CONTEXT_DEVICES',
	'CONTEXT_PROPERTIES', 'CONTEXT_NUM_DEVICES', 'CONTEXT_PLATFORM',
	'CONTEXT_INTEROP_USER_SYNC', 'DEVICE_PARTITION_EQUALLY', 'DEVICE_PARTITION_BY_COUNTS',
	'DEVICE_PARTITION_BY_COUNTS_LIST_END', 'DEVICE_PARTITION_BY_AFFINITY_DOMAIN',
	'DEVICE_AFFINITY_DOMAIN_NUMA', 'DEVICE_AFFINITY_DOMAIN_L4_CACHE',
	'DEVICE_AFFINITY_DOMAIN_L3_CACHE', 'DEVICE_AFFINITY_DOMAIN_L2_CACHE',
	'DEVICE_AFFINITY_DOMAIN_L1_CACHE', 'DEVICE_AFFINITY_DOMAIN_NEXT_PARTITIONABLE',
	'QUEUE_CONTEXT', 'QUEUE_DEVICE', 'QUEUE_REFERENCE_COUNT', 'QUEUE_PROPERTIES',
	'MEM_READ_WRITE', 'MEM_WRITE_ONLY', 'MEM_READ_ONLY', 'MEM_USE_HOST_PTR',
	'MEM_ALLOC_HOST_PTR', 'MEM_COPY_HOST_PTR', 'MEM_HOST_WRITE_ONLY',
	'MEM_HOST_READ_ONLY', 'MEM_HOST_NO_ACCESS', 'MIGRATE_MEM_OBJECT_HOST',
	'MIGRATE_MEM_OBJECT_CONTENT_UNDEFINED', 'R', 'A', 'RG', 'RA', 'RGB', 'RGBA',
	'BGRA', 'ARGB', 'INTENSITY', 'LUMINANCE', 'Rx', 'RGx', 'RGBx', 'DEPTH',
	'DEPTH_STENCIL', 'SNORM_INT8', 'SNORM_INT16', 'UNORM_INT8', 'UNORM_INT16',
	'UNORM_SHORT_565', 'UNORM_SHORT_555', 'UNORM_INT_101010', 'SIGNED_INT8',
	'SIGNED_INT16', 'SIGNED_INT32', 'UNSIGNED_INT8', 'UNSIGNED_INT16', 'UNSIGNED_INT32',
	'HALF_FLOAT', 'FLOAT', 'MEM_OBJECT_BUFFER', 'MEM_OBJECT_IMAGE2D',
	'MEM_OBJECT_IMAGE3D', 'MEM_OBJECT_IMAGE2D_ARRAY', 'MEM_OBJECT_IMAGE1D',
	'MEM_OBJECT_IMAGE1D_ARRAY', 'MEM_OBJECT_IMAGE1D_BUFFER', 'MEM_TYPE', 'MEM_FLAGS',
	'MEM_SIZE', 'MEM_HOST_PTR', 'MEM_MAP_COUNT', 'MEM_REFERENCE_COUNT', 'MEM_CONTEXT',
	'MEM_ASSOCIATED_MEMOBJECT', 'MEM_OFFSET', 'IMAGE_FORMAT', 'IMAGE_ELEMENT_SIZE',
	'IMAGE_ROW_PITCH', 'IMAGE_SLICE_PITCH', 'IMAGE_WIDTH', 'IMAGE_HEIGHT', 'IMAGE_DEPTH',
	'IMAGE_ARRAY_SIZE', 'IMAGE_BUFFER', 'IMAGE_NUM_MIP_LEVELS', 'IMAGE_NUM_SAMPLES',
	'ADDRESS_NONE', 'ADDRESS_CLAMP_TO_EDGE', 'ADDRESS_CLAMP', 'ADDRESS_REPEAT',
	'ADDRESS_MIRRORED_REPEAT', 'FILTER_NEAREST', 'FILTER_LINEAR',
	'SAMPLER_REFERENCE_COUNT', 'SAMPLER_CONTEXT', 'SAMPLER_NORMALIZED_COORDS',
	'SAMPLER_ADDRESSING_MODE', 'SAMPLER_FILTER_MODE', 'MAP_READ', 'MAP_WRITE',
	'MAP_WRITE_INVALIDATE_REGION', 'PROGRAM_REFERENCE_COUNT', 'PROGRAM_CONTEXT',
	'PROGRAM_NUM_DEVICES', 'PROGRAM_DEVICES', 'PROGRAM_SOURCE', 'PROGRAM_BINARY_SIZES',
	'PROGRAM_BINARIES', 'PROGRAM_NUM_KERNELS', 'PROGRAM_KERNEL_NAMES',
	'PROGRAM_BUILD_STATUS', 'PROGRAM_BUILD_OPTIONS', 'PROGRAM_BUILD_LOG',
	'PROGRAM_BINARY_TYPE', 'PROGRAM_BINARY_TYPE_NONE',
	'PROGRAM_BINARY_TYPE_COMPILED_OBJECT', 'PROGRAM_BINARY_TYPE_LIBRARY',
	'PROGRAM_BINARY_TYPE_EXECUTABLE', 'BUILD_SUCCESS', 'BUILD_NONE', 'BUILD_ERROR',
	'BUILD_IN_PROGRESS', 'KERNEL_FUNCTION_NAME', 'KERNEL_NUM_ARGS',
	'KERNEL_REFERENCE_COUNT', 'KERNEL_CONTEXT', 'KERNEL_PROGRAM', 'KERNEL_ATTRIBUTES',
	'KERNEL_ARG_ADDRESS_QUALIFIER', 'KERNEL_ARG_ACCESS_QUALIFIER', 'KERNEL_ARG_TYPE_NAME',
	'KERNEL_ARG_TYPE_QUALIFIER', 'KERNEL_ARG_NAME', 'KERNEL_ARG_ADDRESS_GLOBAL',
	'KERNEL_ARG_ADDRESS_LOCAL', 'KERNEL_ARG_ADDRESS_CONSTANT',
	'KERNEL_ARG_ADDRESS_PRIVATE', 'KERNEL_ARG_ACCESS_READ_ONLY',
	'KERNEL_ARG_ACCESS_WRITE_ONLY', 'KERNEL_ARG_ACCESS_READ_WRITE',
	'KERNEL_ARG_ACCESS_NONE', 'KERNEL_ARG_TYPE_NONE', 'KERNEL_ARG_TYPE_CONST',
	'KERNEL_ARG_TYPE_RESTRICT', 'KERNEL_ARG_TYPE_VOLATILE', 'KERNEL_WORK_GROUP_SIZE',
	'KERNEL_COMPILE_WORK_GROUP_SIZE', 'KERNEL_LOCAL_MEM_SIZE',
	'KERNEL_PREFERRED_WORK_GROUP_SIZE_MULTIPLE', 'KERNEL_PRIVATE_MEM_SIZE',
	'KERNEL_GLOBAL_WORK_SIZE', 'EVENT_COMMAND_QUEUE', 'EVENT_COMMAND_TYPE',
	'EVENT_REFERENCE_COUNT', 'EVENT_COMMAND_EXECUTION_STATUS', 'EVENT_CONTEXT',
	'COMMAND_NDRANGE_KERNEL', 'COMMAND_TASK', 'COMMAND_NATIVE_KERNEL',
	'COMMAND_READ_BUFFER', 'COMMAND_WRITE_BUFFER', 'COMMAND_COPY_BUFFER',
	'COMMAND_READ_IMAGE', 'COMMAND_WRITE_IMAGE', 'COMMAND_COPY_IMAGE',
	'COMMAND_COPY_IMAGE_TO_BUFFER', 'COMMAND_COPY_BUFFER_TO_IMAGE',
	'COMMAND_MAP_BUFFER', 'COMMAND_MAP_IMAGE', 'COMMAND_UNMAP_MEM_OBJECT',
	'COMMAND_MARKER', 'COMMAND_READ_BUFFER_RECT', 'COMMAND_WRITE_BUFFER_RECT',
	'COMMAND_COPY_BUFFER_RECT', 'COMMAND_USER', 'COMMAND_BARRIER',
	'COMMAND_MIGRATE_MEM_OBJECTS', 'COMMAND_FILL_BUFFER', 'COMMAND_FILL_IMAGE',
	'COMMAND_ACQUIRE_GL_OBJECTS', 'COMMAND_RELEASE_GL_OBJECTS', 'COMPLETE', 'RUNNING',
	'SUBMITTED', 'QUEUED', 'BUFFER_CREATE_TYPE_REGION', 'PROFILING_COMMAND_QUEUED',
	'PROFILING_COMMAND_SUBMIT', 'PROFILING_COMMAND_START', 'PROFILING_COMMAND_END',
	'DEVICE_DOUBLE_FP_CONFIG', 'DEVICE_HALF_FP_CONFIG', 'GL_CONTEXT_KHR', 'WGL_HDC_KHR',
	'GLX_DISPLAY_KHR', 'CGL_SHAREGROUP_KHR', 'PLATFORM_ICD_SUFFIX_KHR',
	'DEVICE_COMPUTE_CAPABILITY_MAJOR_NV', 'DEVICE_COMPUTE_CAPABILITY_MINOR_NV',
	'DEVICE_REGISTERS_PER_BLOCK_NV', 'DEVICE_WARP_SIZE_NV', 'DEVICE_GPU_OVERLAP_NV',
	'DEVICE_KERNEL_EXEC_TIMEOUT_NV', 'DEVICE_INTEGRATED_MEMORY_NV',
	'CURRENT_DEVICE_FOR_GL_CONTEXT_KHR', 'DEVICES_FOR_GL_CONTEXT_KHR',
];

const methods: ReadonlyArray<keyof typeof cl> = [
	'createKernel', 'createKernelsInProgram', 'retainKernel', 'releaseKernel',
	'setKernelArg', 'getKernelInfo', 'getKernelArgInfo', 'getKernelWorkGroupInfo',
	'createBuffer', 'createSubBuffer', 'createImage', 'retainMemObject',
	'releaseMemObject', 'getSupportedImageFormats', 'getMemObjectInfo', 'getImageInfo',
	'createFromGLBuffer', 'createFromGLRenderbuffer', 'createFromGLTexture',
	'getPlatformIDs', 'getPlatformInfo', 'createProgramWithSource',
	'createProgramWithBinary', 'createProgramWithBuiltInKernels', 'retainProgram',
	'releaseProgram', 'buildProgram', 'compileProgram', 'linkProgram',
	'unloadPlatformCompiler', 'getProgramInfo', 'getProgramBuildInfo',
	'retainSampler', 'releaseSampler', 'getSamplerInfo', 'createSampler',
	'createCommandQueue', 'retainCommandQueue', 'releaseCommandQueue',
	'getCommandQueueInfo', 'flush', 'finish', 'enqueueReadBuffer',
	'enqueueReadBufferRect', 'enqueueWriteBuffer', 'enqueueWriteBufferRect',
	'enqueueCopyBuffer', 'enqueueCopyBufferRect', 'enqueueReadImage',
	'enqueueWriteImage', 'enqueueCopyImage', 'enqueueCopyImageToBuffer',
	'enqueueCopyBufferToImage', 'enqueueMapBuffer', 'enqueueMapImage',
	'enqueueUnmapMemObject', 'enqueueNDRangeKernel', 'enqueueTask',
	'enqueueNativeKernel', 'enqueueMarker', 'enqueueMarkerWithWaitList',
	'enqueueBarrier', 'enqueueBarrierWithWaitList', 'enqueueFillBuffer',
	'enqueueFillImage', 'enqueueMigrateMemObjects', 'enqueueAcquireGLObjects',
	'enqueueReleaseGLObjects', 'createContext', 'createContextFromType',
	'retainContext', 'releaseContext', 'getContextInfo', 'getDeviceIDs',
	'getDeviceInfo', 'createSubDevices', 'retainDevice', 'releaseDevice',
	'waitForEvents', 'getEventInfo', 'createUserEvent', 'retainEvent',
	'releaseEvent', 'setUserEventStatus', 'setEventCallback', 'getEventProfilingInfo',
];


describe('OpenCL Exported API', () => {
	constants.forEach((constant) => {
		it(`\`${constant}\` constant exposed`, () => {
			assert.ok(cl[constant] !== undefined);
		});
	});
	
	methods.forEach((method) => {
		it(`\`${method}()\` method exposed`, () => {
			assert.strictEqual(typeof cl[method], 'function');
		});
	});
});
